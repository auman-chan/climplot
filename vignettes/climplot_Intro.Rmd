---
title: "climplot: Streamline Plotting the Walter & Lieth Climatic Diagram"
pagetitle: "Introduction to climplot"
author: 
- <a href="https://gitee.com/WYY_Space"> Auman Chan, PhD Candidate</a>
date:  "`r Sys.Date()`"
output: html_document

    
vignette: >
  %\VignetteIndexEntry{1. Introduction and Intro of climplot}
  %\usepackage[utf8]{inputenc}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  
  editor_options: 
  chunk_output_type: console
params:
  EVAL: !r identical(Sys.getenv("NOT_CRAN"), "true")
---

```{css,echo=FALSE}

body {
  margin-top: 16px;
  margin-bottom: 16px;
  font-size: 19px;
  font-weight: 200;
}

#sidebar {
font-size: 16px
}

#sidebar p {
font-size: 16px
}

.contents h1, .contents h2, .contents h3, .contents h4 {
  padding-top: 60px;
  margin-top: -50px;
}

h4 {
  font-size: 19px;
}

h3 {
  font-size: 22px;
}

h2 {
  font-size: 26px;
}

h1 {
  font-size: 30px;
}

pre {
  border: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  white-space: -moz-pre-wrap;
  white-space: -pre-wrap;
  white-space: -o-pre-wrap;
  word-wrap: break-word;
  background: #e9f7ed;
    color: #ffffff;
    padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-left: 20px;
  padding-right: 20px;
  line-height: 21px;
  font-size: 15px;
}

pre code {
  color: #182125;
}

code {
  word-wrap: break-word;
  font-size: 85%;
  font-family: Consolas,Monaco,"Courier New",monospace;
  border-radius: 0;
}

.nav-pills>li>a {
  border-radius: 0;
}

.navbar-default .navbar-nav>.active>a, .navbar-default .navbar-nav>.active>a:focus, .navbar-default .navbar-nav>.active>a:hover {
  color: #408AB4;
}
.navbar-default .navbar-nav>li>a {
  color: #408AB4;
}

table p {
  font-size: 85%;
}

.ref-index h2 {
  font-size: 24px;
}

h1.title {
  font-weight: bold;
  font-size: 180%;
  text-align: center
}

h2.subtitle {
  font-size: 120%;
  text-align: center
}

h3.subtitle {
  font-size: 120%;
  text-align: center
}

h4.author {
  font-size: 120%;
  text-align: center
}

h4.date {
  font-size: 120%;
  text-align: center
}

p {
  margin-bottom: 30px;
}
```

[climplot](https://gitee.com/WYY_Space/climplot) is intended to to acquire essential climate data of Walter & Lieth climatic diagram of locations worldwide, and plot the climatic diagram in a more convenient and customized way.

::: {.alert .alert-info}
The main features of the package are:

-   The use of worldwide climate data for acquiring standard and reliable data for Walter & Lieth climatic diagram plotting
-   The provision for more parameter to customize the plots and display more information

The package offers functions for:

-   Acquire climate data to plot Walter & Lieth Climatic Diagram for locations worldwide
-   Plot the Walter & Lieth climatic diagram
-   Modify the color and information display on the diagram
:::

# Installing and loading

To install the latest developmental version from [gitee](https://gitee.com/) you will need the R package [remotes](https://cran.r-project.org/package=remotes)and [git2r](https://cran.r-project.org/package=git2r):

```{r intasll, eval=FALSE}
install.packages('remotes')
install.packages('git2r')
remotes::install_git("https://gitee.com/WYY_Space/climplot.git")
```

```{r load package,include=FALSE}
#load package
library(climplot)
```

# Plotting data extraction

Searching for and clearing up climate data of numerous location is a tough work. Function **clim_extract** can acquire data calculatd from Worldclim Historical monthly weather data in 2010-2019(Version of 2.5 minutes, <https://worldclim.org/data/monthlywth.html>), and arrange them to be ready for diagram plotting.

## Data preparation

### Climate data download

The climate data from Worldclim are essential. But as the world-scale raster layer, they have large file size and cannot be stored into the package. So please download the climate dataset from [Figshare](NULL). The dataset contains three folders and totally 36 .tif file, containing annual average minimum temperature, annual average maximum temperature and annual average precipitation, which take average among 2010-2019 by months. The structure of the dataset are shown in the table below:

```{r echo=FALSE}
read.csv("climdata.csv")
```

The download link of original data as below:

[2010-2019 monthly minimum temperature](https://geodata.ucdavis.edu/climate/worldclim/2_1/hist/cts4.06/2.5m/wc2.1_cruts4.06_2.5m_tmin_2010-2019.zip)

[2010-2019 monthly maximum temperature](https://geodata.ucdavis.edu/climate/worldclim/2_1/hist/cts4.06/2.5m/wc2.1_cruts4.06_2.5m_tmax_2010-2019.zip)

[2010-2019 monthly precipitation](https://geodata.ucdavis.edu/climate/worldclim/2_1/hist/cts4.06/2.5m/wc2.1_cruts4.06_2.5m_prec_2010-2019.zip)

If you want to calculate the dataset by yourself, download the original data and follow the code below.Because of the calculation required a lot of memory usage and time, lack of generality.So we haven't import them into package as a function.

```{r  cal_code,eval=FALSE}
#The code for climatic data calculation with Worldclim data.
#
#imp_path: path of import Worldclim Historical monthly weather data,
#each kind of dataset(mintemp,maxtemp,prec)should be saparated in different folders.

#exp_path: path of export arranged data in format of .tif

#name: the name of tif file to differentiate the data

#method: the method for calculating the raster,default is "mean" to calculate
#annual average climatic values
#Set as "min" to calculate annual minimum climatic values for forst month display.

clim_cal <- function(imp_path,
                     exp_path,
                     name=NA,
                     method="mean",
                     ...){
tifname <- list.files(imp_path,full.names = T)

rastermean <- function(num){
  tif <- tifname[tifname %>% str_detect(pattern = paste0("-",num,".tif"))]
  val <- lapply(tif,raster) %>% raster::brick() %>% calc(mean)
  return(val)
}

rastermin <- function(num){
  tif <- tifname[tifname %>% str_detect(pattern = paste0("-",num,".tif"))]
  val <- lapply(tif,raster) %>% brick() %>% calc(min)
  return(val)
}

plan(multisession,workers= parallel)
month <- c(1:12) %>% str_pad(2,side = "left","0")

if(method=="mean"){
  raster <- future_lapply(month,function(x) rastermean(x))
}else if(method=="min"){
  raster <- future_lapply(month,function(x) rastermin(x))
}

rasterstack <- raster %>% stack()
path <- exp_path
for(i in 1:12){
  ras <- raster(rasterstack,layer=i)
  #export the RasterLayer
  writeRaster(ras,file.path(path,paste0(name,month[i],".tif")))
}

}
```

### Location information preparation

To extract climate data of specified locations, the coordinates are very essential. Other information like name of the locations, altitudes would need to display on the diagram. Therefore, a data.frame with information of the target locations are required. The import data.frame of **clim_extract** should contain 5 columns in order:

-   No: Serial number of the locations
-   location: Abbreviation of the locations
-   lon: Longitude of the locations in decimal digit(East longitude are represented by negative numbers)
-   lat: Latitude of the locations in decimal digit(South latitude are represented by negative numbers)
-   altitude: Altitude of the locations

The data **locdata** of the package can be a example of data.frame. Any extra columns behind columns above(just like the example) would be allowed, but they would be discarded in the process of function.

```{r global options, echo=FALSE, message=FALSE, warning=FALSE}
data("locdata")
locdata
```

## Extraction of climate data
After preparing the dataset of climate and the information of locations, The data extraction is ready. Import the table and the path of three climate dataset, and the function export a table. The data.frame export includes 5 kinds of information of locations(as which in the data.frame import), and values of three kinds of climate factors among 12 months.

An export data.frame stores in the data **plotdata** of the package,as an example of the function export.

```{r extraction,eval=FALSE}
#Modify the path of yours
a <- "D:/climplot/climdata/mean_mintemp"
 b <- "D:/climplot/climdata/mean_maxtemp"
 c <- "D:/climplot/climdata/mean_prec"
#' #extraction of climate data

plotdata <- clim_extract(locdata,a,b,c)
}
```
```{r echo=FALSE}
data("plotdata")
plotdata
```

# Climatic diagram Plotting

