---
title: "climplot: Streamline Plotting the Walter & Lieth Climatic Diagram"
pagetitle: "Introduction to climplot"
author: 
- <a href="https://gitee.com/WYY_Space"> Auman Chan, PhD Candidate</a>
date:  "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    df_print: paged
    self_contained: yes
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: true

vignette: >
  %\VignetteIndexEntry{1. Introduction and Intro of climplot}
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}
  
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  
  chunk_output_type: console
params:
  EVAL: !r identical(Sys.getenv("NOT_CRAN"), "true")
---

```{css,echo=FALSE}

body {
  margin-top: 16px;
  margin-bottom: 16px;
  font-size: 19px;
  font-weight: 200;
}

#sidebar {
font-size: 16px
}

#sidebar p {
font-size: 16px
}

.contents h1, .contents h2, .contents h3, .contents h4 {
  padding-top: 60px;
  margin-top: -50px;
}

h4 {
  font-size: 19px;
}

h3 {
  font-size: 22px;
}

h2 {
  font-size: 26px;
}

h1 {
  font-size: 30px;
}

pre {
  border: 0;
  overflow-x: auto;
  white-space: pre-wrap;
  white-space: -moz-pre-wrap;
  white-space: -pre-wrap;
  white-space: -o-pre-wrap;
  word-wrap: break-word;
  background: #e9f7ed;
    color: #ffffff;
    padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-left: 20px;
  padding-right: 20px;
  line-height: 21px;
  font-size: 15px;
}

pre code {
  color: #182125;
}

code {
  word-wrap: break-word;
  font-size: 85%;
  font-family: Consolas,Monaco,"Courier New",monospace;
  border-radius: 0;
}

.nav-pills>li>a {
  border-radius: 0;
}

.navbar-default .navbar-nav>.active>a, .navbar-default .navbar-nav>.active>a:focus, .navbar-default .navbar-nav>.active>a:hover {
  color: #408AB4;
}
.navbar-default .navbar-nav>li>a {
  color: #408AB4;
}

table p {
  font-size: 85%;
}

.ref-index h2 {
  font-size: 24px;
}

h1.title {
  font-weight: bold;
  font-size: 180%;
  text-align: center
}

h2.subtitle {
  font-size: 120%;
  text-align: center
}

h3.subtitle {
  font-size: 120%;
  text-align: center
}

h4.author {
  font-size: 120%;
  text-align: center
}

h4.date {
  font-size: 120%;
  text-align: center
}

p {
  margin-bottom: 30px;
}
```

[climplot](https://gitee.com/WYY_Space/climplot) is intended to acquire essential climate data of Walter & Lieth climatic diagram of locations worldwide, and plot the climatic diagram in a more convenient and customized way.

::: {.alert .alert-info}
The main features of the package are:

-   The use of worldwide climate data for acquiring standard and reliable data to plot Walter & Lieth climatic diagram 
-   The provision for more parameter to customize the plots and display more information

The package offers functions for:

-   Acquire climate data to plot Walter & Lieth Climatic Diagram for locations worldwide
-   Plot the Walter & Lieth climatic diagram
-   Modify the color and information display on the diagram
:::

# Installing and loading

To install the latest developmental version from [gitee](https://gitee.com/) you will need the R package [remotes](https://cran.r-project.org/package=remotes)and [git2r](https://cran.r-project.org/package=git2r):

```{r intasll, eval=FALSE}
install.packages('remotes')
install.packages('git2r')
remotes::install_git("https://gitee.com/WYY_Space/climplot.git")
```

```{r load package,include=FALSE}
#load package
library(climplot)
```

# Plotting data extraction

Searching for and clearing up climate data of numerous location is a tough work. Function `clim_extract` can acquire data calculatd from Worldclim Historical monthly weather data in 2010-2019(Version of 2.5 minutes, <https://worldclim.org/data/monthlywth.html>), and arrange them to be ready for diagram plotting.

## Data preparation

### Climate data download

The climate data from Worldclim are essential. But as the world-scale raster layer, they have large file size and cannot be stored into the package. So please download the climate dataset from [Figshare](NULL). The dataset contains four folders and totally 36 .tif file, containing annual average minimum temperature, annual average maximum temperature, annual average precipitation, and annual extreme minimum temperature,which take average and minimization among 2010-2019 by months. The structure of the dataset are shown in the table below:

```{r echo=FALSE}
read.csv("climdata.csv")
```

### Location information preparation

To extract climate data of specified locations, the coordinates are very essential. Other information like name of the locations, altitudes would need to display on the diagram. Therefore, a data.frame with information of the target locations are required. The import data.frame of `clim_extract` should contain 5 columns in order:

-   **No**: Serial number of the locations
-   **location**: Abbreviation of the locations
-   **lon**: Longitude of the locations in decimal digit (East longitude are represented by negative numbers)
-   **lat**: Latitude of the locations in decimal digit (South latitude are represented by negative numbers)
-   **altitude**: Altitude of the locations

The data `locdata` of the package can be a example of data.frame. Any extra columns behind columns above(just like the example) would be allowed, but they would be discarded in the process of function.

```{r global options, echo=FALSE, message=FALSE, warning=FALSE}
data("locdata")
locdata
```

## Extraction of climate data

After preparing the dataset of climate and the information of locations, The data extraction is ready. Import the table and the path of three climate datasets, the function would export a data.frame.

```{r extraction,eval=FALSE}
#Modify the path of yours
a <- "G:/climplot/climdata/tmin"
b <- "G:/climplot/climdata/tmax"
c <- "G:/climplot/climdata/prec"

#extraction of climate data

plotdata <- clim_extract(locdata,a,b,c)
}
```

```{r plotdata,echo=FALSE}
data("plotdata")
plotdata
```

The data.frame export includes 5 kinds of information of locations(as which in the data.frame import), and values of 3 kinds of climate factors among 12 months.An export data.frame stores in the data `plotdata` of this package, as an example of the function export.

If you want to display the frosty months in subsequent plotting, you should also extract the extreme minimum temperature of every locations. Change the parameter `Frost` from "FALSE" to "TRUE", and provide the path of the dataset of annual extreme minimum temperature.

```{r extraction with Frost,eval=FALSE}
#Modify the path of yours
a <- "G:/climplot/climdata/tmin"
b <- "G:/climplot/climdata/tmax"
c <- "G:/climplot/climdata/prec"
d <- "G:/climplot/climdata/extmin"
#extraction of climate data

plotdata <- clim_extract(locdata,a,b,c,Frost = TRUE,d)
}
```

```{r plotdata_F,echo=FALSE}
data("plotdata_Frost")
plotdata_Frost
```

In this mode, the data.frame export includes 5 kinds of information of locations(as which in the data.frame import),and values of 4 kinds of climate factors among 12 months. The annual extreme minimum temperature are added as a new row of every location. An export data.frame of this mode stores in the data `plotdata_Frost` of this package,as an example of the function export.

# Climatic diagram Plotting

The data.frame export from the function `clim_extact` have all essential information for the Walter & Lieth climatic diagram plotting.

The function `clim_plot` can help plotting the Walter & Lieth climatic diagram plotting in multiple choice of style and information.

## Walter & Lieth climatic diagram plotting of a single location

Take the data `plotdata` and `plotdata_Frost` as an example, and import them into `clim_plot`.

```{r plot1}
data("plotdata")
loc <- subset(plotdata,No==2)
clim_plot(loc)

```

In the picture above:

-   The red curve represents the variation of temperature annually, and blue one represents the variation of precipitation. They compose two kinds of patch, which means the degree of humidity and aridity. The patch filled with string are the humid season, and the one filled with scatter points are the arid season. The months with precipitation above 100mm would be a polygon filled with the color of precipitation, display the time of wet season.

-   The information on the left top includes the name, the altitude and the coordinates of the locations. The right top are the annual mean temperature and mean precipitation of this place.

## Solution to plot for serveral location

`clim_plot`only supports plotting diagram for one location at one time, because we consider the check of every plot are recommended, and import multiple vectors of climate data are prone to error. So if you need to plot several locations automatically, you can use the loop for help:

```{r plot mutli, eval=FALSE}
data("plotdata")
list <- unique(plotdata$No)
par(mfrow=c(1,1))
for (i in 1:5){
 k <- list[i]
sub <- subset(plotdata,No==k)
clim_plot(data=sub,ylabel = TRUE,
          ylab1="Temperature(\U{00B0}C)",
          ylab2="Precipitation(mm)",
           p50line = TRUE)
}
```

## Other tips of climatic diagram plotting

### Plotting the frosty months

```{r plot frost, echo=TRUE}

data("plotdata_Frost")
loc <- subset(plotdata_Frost,No==3)
clim_plot(data=loc,ShowForst = T)
```

The blocks with light blue color on x-axis represent the months with potential frost.

### Color and axis modification

The color and the axis labels could be customized for different requirement.

The color of the curve of temperature, the curve of precipitation, the patch of humidity, aridity and wet season, and the block of frosty months could change.

```{r color picker, echo=TRUE}
loc <- subset(plotdata_Frost,No==1)
clim_plot(loc,pcol = "#8DB6CD",tcol = "#FF6A6A",wcol="#4EEE94",dcol = "#EEB422",pfcol="#00BFFF",sfcol="#8A2BE2",ShowForst = TRUE)

```

Also you can control whether display your axis labels or import your labels with the parameter `ylabel`, `ylab1`, `ylab2` `mlab` and `xlab` .

```{r label, echo=TRUE}
loc <- subset(plotdata_Frost,No==1)
clim_plot(loc,xlab="月份",mlab = "en",ylabel = TRUE,ylab1 ="Temperature(\U{00B0}C)",ylab2 ="Precipitation(mm)",ShowForst = TRUE)
```

### Auxiliary marker

You can also print extreme temperatures, and the auxiliary line of precipitation curve and position of 50°C-100mm.

```{r auxiliary line}
loc <- subset(plotdata_Frost,No==1)
clim_plot(loc,p3line = TRUE,p50line = TRUE,extremeT = TRUE,ShowForst = TRUE)
```

## Reference

1.  Guijarro J A (2023). climatol: Climate Tools (Series Homogenization and Derived Products), 4.0.0., <https://CRAN.R-project.org/package=climatol>.

2. Fick, S.E. and R.J. Hijmans, (2017). WorldClim 2: new 1km spatial resolution climate surfaces for global land areas. International Journal of Climatology 37 (12): 4302-4315.

3.  Harris, I., Osborn, T.J., Jones, P.D., Lister, D.H. (2020). Version 4 of the CRU TS monthly high-resolution gridded multivariate climate dataset. Scientific Data 7: 109.

4. Walter H & Lieth H (1960): Klimadiagramm Weltatlas. G. Fischer, Jena.
